name: Releases

on:
  push:
    tags:
    - '*'

permissions:
  contents: write

jobs:
  build:
    name: Release pushed tag
    runs-on: ${{ matrix.config.os }}
    strategy:
      fail-fast: false
      matrix:
        config:
          - {
            name: "Ubuntu Latest",
            os: ubuntu-latest,
            artifact: "ubuntu.7z",
            build_type: "Release",
            cc: "clang",
            cxx: "clang++",
            generators: "Ninja"
          }
          - {
            name: "MacOS Latest",
            os: macos-latest,
            artifact: "mac.7z",
            build_type: "Release",
            cc: "clang",
            cxx: "clang++",
            archiver: "7za a",
            generators: "Ninja"
          }
    steps:
      - uses: actions/checkout@v4
      - name: Make release
        run: make
      - name: Create release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          tag: ${{ github.ref_name }}
        run:
          gh release create "$tag" --repo="$GITHUB_REPOSITORY" --title="${tag#v}" --generate-notes build/TicTacToe
    
